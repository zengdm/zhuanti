define(function(require,e,t){"use strict";var n,i,o,r,a,s="http://car.diandong.com/api/get_local",d="http://mall.diandong.com/api/get_order_count";i=require("area"),o=require("cookie"),r=require("user"),a=require("./topbar.tpl"),n={elements:{cityBtn:$(".topbar-city-btn"),loginBtn:$(".topbar-login"),userInfo:$(".topbar-user"),orderInfo:$(".topbar-order a"),codeBtn:$(".j-show-code"),mobileCode:$(".mobile-code")},init:function(){this.initArea(),""!==r.id&&this.renderOrder(),this.bindEvent()},bindEvent:function(){var e=this;this.elements.codeBtn.on("mouseenter",function(t){e.elements.mobileCode.removeClass("fn-hide")}).on("mouseleave",function(){e.elements.mobileCode.addClass("fn-hide")})},initArea:function(){var e=this;i.init(function(){""===i.name||""===i.id?e.getCity():e.renderCity(i.name)})},renderCity:function(e){this.elements.cityBtn.html(e)},getCity:function(){var e=this;$.ajax({url:s,data:{},dataType:"jsonp",type:"GET",success:function(t){t.state.err||(e.renderCity(t.data.city),e.setCookie({cityName:t.data.city,cityId:t.data.code}))}})},setCookie:function(e){for(var t in e)o.set(t,e[t],{path:"/",domain:".diandong.com"})},renderUser:function(e){this.elements.userInfo.removeClass("fn-hide").html(juicer(a.user,{userName:r.nickname})),this.elements.loginBtn.addClass("fn-hide"),this.elements.orderInfo.attr("href","http://mall.diandong.com/my/order/").html(e)},renderOrder:function(){var e=this,t=0,n="";$.ajax({url:d,data:{},dataType:"jsonp",type:"GET",success:function(i){t=i.state.err?0:"0"===i.code?i.data[2].count||0:0,n=0===t?"我的订单":"我的订单(<span>"+t+"</span>)",e.renderUser(n)}})}},t.exports=n});