define(function(require,t,e){var n,i,o;i={CARBRAND:"http://car.diandong.com/api/listData/brand",CARSERIES_MARKET:"http://car.diandong.com/api/listData/series/",CARSERIES:"http://car.diandong.com/api/listData/series_product_status/",CARTYPE:"http://car.diandong.com/api/listData/model/"},onsaleApi={CARBRAND:"http://mall.diandong.com/api/listData/saleBrand",CARSERIES_MARKET:"http://mall.diandong.com/api/listData/saleSeries/",CARSERIES:"http://car.diandong.com/api/listData/series_product_status/",CARTYPE:"http://mall.diandong.com/api/listData/saleModel/"},o={BRAND_OPTION:'<option value="0">选择品牌</option>',SEIRES_OPTION:'<option value="0">选择车系</option>',MODEL_OPTION:'<option value="0">选择车型</option>'},n=function(t){this.options=$.extend({nomarket:!0,onsale:!1},t),this.options.onsale&&(i=onsaleApi),this.bindEvent()},n.prototype={bindEvent:function(){var t=this,e=this.options.elements.brand,n=this.options.elements.series,i=this.options.elements.model;e.on("change",function(){var e=this.value;i.html(o.MODEL_OPTION),t.getSeries(e)}),n.on("change",function(e){var n=this.value;t.getModel(n)}),i.on("change",function(){var e=this.value;t.options.complete&&t.options.complete(e)})},request:function(t,e){$.ajax({url:t,type:"get",dataType:"jsonp",success:e})},initCar:function(t,e,n){function i(){o.val(t),r.getSeries(t,function(){a.val(e),r.getModel(e,function(){s.val(n),r.options.complete&&r.options.complete(n)})})}var o=this.options.elements.brand||0,a=this.options.elements.series||0,s=this.options.elements.model||0,r=this;o.children().length>1?i():this.getBrands(i)},getBrands:function(t){var e=this,n=this.options.elements.brand;this.request(i.CARBRAND,function(i){if(i.state.err===!1){var o=i.data,a=e.createBrandsElements(o);n.html(a),t&&t()}})},createBrandsElements:function(t){var e=o.BRAND_OPTION;for(var n in t)for(var i=t[n],a=0;a<i.length;a++){var s=i[a],r=s.ppid,l=s.name,p="<option value="+r+">"+n+"-"+l+"</option>";e+=p}return e},getSeries:function(t,e){var n=this,o=this.options.nomarket?i.CARSERIES+t:i.CARSERIES_MARKET+t,a=this.options.elements.series;this.request(o,function(t){if(t.state.err===!1){var i=t.data,o=n.createSeriesElements(i);a.html(o),e&&e()}})},createSeriesElements:function(t){for(var e=o.SEIRES_OPTION,n=0,i=t.length;i>n;n++){var a=t[n],s=a.cxid,r=a.name,l="<option value="+s+">"+r+"</option>";e+=l}return e},getModel:function(t,e){var n=this,o=i.CARTYPE+t,a=this.options.elements.model;return 0==t?void n.createTypeElements([]):void this.request(o,function(t){if(t.state.err===!1){var i=t.data,o=n.createTypeElements(i);a.html(o),e&&e()}})},createTypeElements:function(t){for(var e=o.MODEL_OPTION,n=0,i=t.length;i>n;n++){var a=t[n],s=a.pzid,r=a.name,l="<option value="+s+">"+r+"</option>";e+=l}return e}},e.exports=n});