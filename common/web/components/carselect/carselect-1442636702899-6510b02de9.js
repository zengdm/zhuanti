define(function(require,t,e){var n,o,i;o={CARBRAND:"http://car.diandong.com/api/listData/brand",CARSERIES_MARKET:"http://car.diandong.com/api/listData/series/",CARSERIES:"http://car.diandong.com/api/listData/series_product_status/",CARTYPE:"http://car.diandong.com/api/listData/model/"},i={BRAND_OPTION:'<option value="0">选择品牌</option>',SEIRES_OPTION:'<option value="0">选择车系</option>',MODEL_OPTION:'<option value="0">选择车型</option>'},n=function(t){this.options=$.extend({nomarket:!0},t),this.bindEvent()},n.prototype={bindEvent:function(){var t=this,e=this.options.elements.brand,n=this.options.elements.series,o=this.options.elements.model;e.on("change",function(){var e=this.value;o.html(i.MODEL_OPTION),t.getSeries(e)}),n.on("change",function(e){var n=this.value;t.getModel(n)}),o.on("change",function(){var e=this.value;t.options.complete&&t.options.complete(e)})},request:function(t,e){$.ajax({url:t,type:"get",dataType:"jsonp",success:e})},initCar:function(t,e,n){function o(){i.val(t),r.getSeries(t,function(){s.val(e),r.getModel(e,function(){a.val(n),r.options.complete&&r.options.complete(n)})})}var i=this.options.elements.brand||0,s=this.options.elements.series||0,a=this.options.elements.model||0,r=this;i.children().length>1?o():this.getBrands(o)},getBrands:function(t){var e=this,n=this.options.elements.brand;this.request(o.CARBRAND,function(o){if(o.state.err===!1){var i=o.data,s=e.createBrandsElements(i);n.html(s),t&&t()}})},createBrandsElements:function(t){var e=i.BRAND_OPTION;for(var n in t)for(var o=t[n],s=0;s<o.length;s++){var a=o[s],r=a.ppid,l=a.name,p="<option value="+r+">"+n+"-"+l+"</option>";e+=p}return e},getSeries:function(t,e){var n=this,i=this.options.nomarket?o.CARSERIES+t:o.CARSERIES_MARKET+t,s=this.options.elements.series;this.request(i,function(t){if(t.state.err===!1){var o=t.data,i=n.createSeriesElements(o);s.html(i),e&&e()}})},createSeriesElements:function(t){for(var e=i.SEIRES_OPTION,n=0,o=t.length;o>n;n++){var s=t[n],a=s.cxid,r=s.name,l="<option value="+a+">"+r+"</option>";e+=l}return e},getModel:function(t,e){var n=this,i=o.CARTYPE+t,s=this.options.elements.model;this.request(i,function(t){if(t.state.err===!1){var o=t.data,i=n.createTypeElements(o);s.html(i),e&&e()}})},createTypeElements:function(t){for(var e=i.MODEL_OPTION,n=0,o=t.length;o>n;n++){var s=t[n],a=s.pzid,r=s.name,l="<option value="+a+">"+r+"</option>";e+=l}return e}},e.exports=n});