define(function(require,t,e){"use strict";var r=require("cookie"),n=require("area"),a=require("user"),i=require("./topbar-afc8ecd266.tpl");require("./topbar-69278bf9d4.css");var o="http://car.diandong.com/api/get_local",d="http://mall.diandong.com/api/get_order_count",c=function(){this.init()};c.prototype={init:function(){this.render(),this.initArea(),""!==a.id&&this.renderOrder()},render:function(){var t=juicer(i.topbar,{redirectUrl:location.href});$(document.body).prepend(t)},initArea:function(){var t=this;n.init(function(){""===n.name||""===n.id?t.getCity():t.renderCity(n.name)})},getCity:function(){var t=this;$.ajax({url:o,data:{},dataType:"jsonp",type:"GET",success:function(e){e.state.err||(t.renderCity(e.data.city),t.setCookie({cityName:e.data.city,cityId:e.data.code}))}})},renderCity:function(t){$(".current-city").html(t)},setCookie:function(t){for(var e in t)r.set(e,t[e],{path:"/",domain:".diandong.com"})},renderOrder:function(){var t=this,e=0,r="";$.ajax({url:d,data:{},dataType:"jsonp",type:"GET",success:function(n){e=n.state.err?0:"0"===n.code?n.data[2].count||0:0,r=0===e?"我的订单":"我的订单(<span>"+e+"</span>)",t.renderUser(r)}})},renderUser:function(t){$(".topbar-link-login").addClass("fn-hide"),$(".topbar-link-register").addClass("fn-hide"),$(".topbar-link-logout").removeClass("fn-hide"),$(".topbar-link-user").removeClass("fn-hide"),$(".topbar-link-user a").html(a.nickname),$(".topbar-link-order a").attr("href","http://mall.diandong.com/my/order/").html(t)}},e.exports=c});